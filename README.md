# Bailanysta

# Demo: https://bailanysta.gorislavets.com/
# Video Demo: potom

## Краткое описание проекта

**Bailanysta** - это социальная веб-платформа. Платформа позволяет пользователям регистрироваться с помощью Google Sign-In, публиковать текстовые посты с изображениями, просматривать ленту постов других пользователей, ставить лайки, комментировать, редактировать и удалять свои посты, а также подписываться на других пользователей. Проект реализован с использованием кастомной легковесной MVC-архитектуры на PHP, базы данных MySQL и современного фронтенд-стека с Vite и Tailwind CSS.

Цель проекта — продемонстрировать создание современного веб-приложения с нуля, включая аутентификацию, работу с базой данных, AJAX-взаимодействия, загрузку файлов, интеграцию с внешними API (Google AI Gemini) и развертывание на реальном сервере.

## Инструкции по установке и запуску

### Требования к серверу

*   Веб-сервер (Apache 2.4+ с `mod_rewrite`, `mod_proxy_fcgi`)
*   PHP >= 8.1 (с расширениями: `pdo_mysql`, `mbstring`, `xml`, `curl`, `gd`, `intl`, `zip`, `bcmath`)
*   PHP-FPM (рекомендуется для работы с Apache/Nginx)
*   MySQL >= 5.7 или MariaDB >= 10.2
*   Composer 2+
*   Node.js >= 18.x
*   npm >= 8.x
*   Git (для клонирования репозитория)

### Установка

1.  **Клонировать репозиторий:**
    ```bash
    git clone https://github.com/themilan1337/bailanysta/ /var/www/bailanysta.gorislavets.com
    cd /var/www/bailanysta.gorislavets.com
    ```
    *(Замените путь `/var/www/bailanysta.gorislavets.com` на ваш)*

2.  **Установить PHP зависимости:**
    ```bash
    composer install --no-dev --optimize-autoloader
    ```

3.  **Установить Node.js зависимости:**
    ```bash
    npm ci
    ```

4.  **Настройка базы данных:**
    *   Создайте базу данных MySQL (например, `bailanysta_prod`) с кодировкой `utf8mb4` и `utf8mb4_unicode_ci`.
    *   Создайте пользователя MySQL (например, `bailanysta_user`) и предоставьте ему все привилегии для созданной базы данных.
    *   Импортируйте дамп вашей базы данных (если есть) или выполните SQL-скрипт для создания таблиц (см. предыдущие шаги разработки).
        ```bash
        # Пример импорта дампа
        mysql -u bailanysta_user -p bailanysta_prod < /path/to/your_dump.sql
        ```

5.  **Настроить приложение:**
    *   Скопируйте или переименуйте файл конфигурации, если необходимо.
    *   Откройте файл `config/config.php`.
    *   Установите **корректные** значения для следующих констант:
        *   `BASE_URL` (например, `'https://bailanysta.gorislavets.com'`)
        *   `APP_ENV` (установите `'production'`)
        *   `DB_HOST`, `DB_PORT`, `DB_DATABASE`, `DB_USERNAME`, `DB_PASSWORD` (данные вашей БД)
        *   `GOOGLE_CLIENT_ID`, `GOOGLE_CLIENT_SECRET` (учетные данные Google OAuth)
        *   `GOOGLE_REDIRECT_URI` (должен совпадать с `BASE_URL . '/auth/google/callback'`)
        *   `GEMINI_API_KEY` (ваш ключ API для Google Gemini)

6.  **Настроить права доступа:**
    *   Веб-сервер (обычно пользователь `www-data` для Apache на Ubuntu) должен иметь права на запись в директории:
        *   `public/uploads/users/`
        *   `public/uploads/posts/`
        *   `storage/cache/htmlpurifier` (если бы мы его использовали)
    ```bash
    # Пример для Ubuntu/Apache (замените your_deploy_user на вашего пользователя)
    sudo chown -R your_deploy_user:www-data /var/www/bailanysta.gorislavets.com
    sudo mkdir -p /var/www/bailanysta.gorislavets.com/public/uploads/users
    sudo mkdir -p /var/www/bailanysta.gorislavets.com/public/uploads/posts
    sudo chown -R www-data:www-data /var/www/bailanysta.gorislavets.com/public/uploads
    # Установить права (группа www-data может писать)
    sudo find /var/www/bailanysta.gorislavets.com/public/uploads -type d -exec chmod 775 {} \;
    sudo find /var/www/bailanysta.gorislavets.com/public/uploads -type f -exec chmod 664 {} \;
    # Установить общие права для остального проекта
    sudo find /var/www/bailanysta.gorislavets.com -type d ! -path "/var/www/bailanysta.gorislavets.com/public/uploads/*" -exec chmod 775 {} \;
    sudo find /var/www/bailanysta.gorislavets.com -type f ! -path "/var/www/bailanysta.gorislavets.com/public/uploads/*" -exec chmod 664 {} \;
    ```

7.  **Собрать фронтенд ассеты:**
    ```bash
    npm run build
    ```
    *(Это создаст оптимизированные файлы CSS/JS в `public/build`)*

### Настройка веб-сервера (Apache)

1.  Создайте файл конфигурации виртуального хоста:
    ```bash
    sudo nano /etc/apache2/sites-available/bailanysta.gorislavets.com.conf
    ```
2.  Вставьте следующую конфигурацию (заменив `bailanysta.gorislavets.com` и пути):
    ```apache
    <VirtualHost *:80>
        ServerAdmin admin@bailanysta.gorislavets.com
        ServerName bailanysta.gorislavets.com

        DocumentRoot /var/www/bailanysta.gorislavets.com/public

        <Directory /var/www/bailanysta.gorislavets.com/public>
            Options -Indexes +FollowSymLinks
            AllowOverride None
            Require all granted
        </Directory>

        FallbackResource /index.php

        <FilesMatch \.php$>
            # Убедитесь, что путь к сокету PHP-FPM верный для вашей версии PHP
            SetHandler "proxy:unix:/run/php/php8.1-fpm.sock|fcgi://localhost/"
        </FilesMatch>

        ErrorLog ${APACHE_LOG_DIR}/bailanysta.gorislavets.com-error.log
        CustomLog ${APACHE_LOG_DIR}/bailanysta.gorislavets.com-access.log combined
    </VirtualHost>
    ```
3.  Включите сайт и перезагрузите Apache:
    ```bash
    sudo a2ensite bailanysta.gorislavets.com.conf
    sudo a2enmod rewrite proxy_fcgi # Убедитесь что модули включены
    sudo systemctl reload apache2
    sudo systemctl restart apache2
    sudo systemctl restart php8.1-fpm # Перезапустите PHP-FPM
    ```
4.  **Настройте HTTPS (SSL):** Используйте Certbot для получения бесплатного SSL-сертификата от Let's Encrypt:
    ```bash
    sudo apt install certbot python3-certbot-apache
    sudo certbot --apache -d bailanysta.gorislavets.com
    ```
    *(Следуйте инструкциям Certbot)*

### Запуск

После выполнения всех шагов, приложение должно быть доступно по адресу `https://bailanysta.gorislavets.com`.

## Описание процесса проектирования и разработки

Разработка велась итеративно, основываясь на предоставленном техническом задании.

1.  **Инициализация проекта:** Настройка базовой структуры папок, инициализация `composer` и `npm`.
2.  **Архитектура:** Выбрана легковесная MVC-структура без использования полноценного фреймворка. Созданы базовые директории для контроллеров, моделей (хотя явные модели не создавались, взаимодействие с БД шло через PDO в контроллерах), представлений и ядра.
3.  **Основные компоненты:**
    *   **Роутинг:** Интегрирована библиотека `nikic/fast-route` для обработки URL-запросов и их направления в соответствующие методы контроллеров. Настроен фронт-контроллер (`public/index.php`).
    *   **Конфигурация:** Создан файл `config/config.php` для хранения констант (URL, данные БД, ключи API). Первоначальная идея использовать `.env` была изменена по ходу разработки.
    *   **База данных:** Определена схема БД MySQL, взаимодействие реализовано через PDO с использованием функции-хелпера `get_db_connection()`.
4.  **Аутентификация:** Реализован вход через Google Sign-In с использованием библиотеки `google/apiclient`. Добавлена логика сохранения/обновления пользователя в БД и управления сессией. Реализовано локальное сохранение аватаров пользователей для избежания проблем с Google `lh3.googleusercontent.com`.
5.  **Фронтенд:**
    *   **Vite:** Настроен для сборки фронтенд-ассетов (CSS, JS) и обеспечения HMR в режиме разработки. Создан `vite.config.mjs` и скрипты `dev`/`build` в `package.json`.
    *   **Tailwind CSS:** Установлена v4, настроена через `@tailwindcss/vite` и директивы `@theme`/`@layer base` в `app.css` для создания утилитарного UI в стиле shadcn.
    *   **Шаблонизация:** Использовались простые PHP-файлы для представлений с базовым макетом (`layouts/app.php`) и частичными представлениями (`_partials/post_card.php`). Функция-хелпер `view()` использовалась для рендеринга.
6.  **Реализация фич:**
    *   Создание, редактирование, удаление постов (текст + изображение).
    *   Лента постов.
    *   Профиль пользователя (просмотр своего и чужих).
    *   Лайки, комментарии, подписки с использованием AJAX для динамического обновления без перезагрузки страницы.
    *   Уведомления (создание на бэкенде, отображение на фронтенде с AJAX-обновлением статуса).
    *   Загрузка изображений для постов и аватаров пользователей.
    *   Поиск постов по ключевым словам (базовая реализация с AJAX).
    *   Генерация идей для постов с помощью Google Gemini API (через cURL).
    *   Темная/Светлая тема с сохранением в cookies.
    *   Реализация адаптивного дизайна для шапки сайта.

## Уникальные подходы или методологии

*   **Гибридный подход:** Сочетание традиционного PHP MVC бэкенда с современным фронтенд-инструментарием (Vite, Tailwind CSS v4) без использования полноценного JS-фреймворка (React/Vue).
*   **Легковесный MVC:** Отказ от тяжелых фреймворков в пользу кастомной структуры для большего контроля и понимания процесса, но с использованием стандартных компонентов (Composer, PSR-4, FastRoute).
*   **Акцент на AJAX:** Многие ключевые взаимодействия (лайки, комментарии, подписки, поиск, редактирование) реализованы через AJAX (используя `fetch` API) для улучшения UX и создания ощущения SPA (Single Page Application) без его полной реализации.

## Компромиссы, принятые во время разработки

*   **Ручная обработка AJAX:** Без JS-фреймворка потребовалось вручную писать логику для обновления DOM, управления состоянием кнопок, обработки ошибок AJAX, что может стать сложным в поддержке при росте проекта.
*   **Базовый поиск:** Реализован простой поиск по `LIKE`, который неэффективен для больших объемов текста и не поддерживает сложную релевантность или поиск по хэштегам. FULLTEXT или внешние движки (Elasticsearch) не использовались.
*   **Простая шаблонизация:** Использование `include` и `extract` просто, но менее функционально и безопасно (в плане экранирования), чем специализированные шаблонизаторы (Twig, Blade).
*   **Временное решение для времени:** Из-за сложностей с настройкой UTC/DateTime, вернулись к использованию `strtotime`/`time`, что может приводить к неточному отображению "time ago" в зависимости от таймзон сервера/БД.
*   **Базовое кэширование:** Кроме HTTP-заголовков для статики, специфическое кэширование (OpCache, Redis, Memcached) для PHP или данных не настраивалось.
*   **Безопасность:** Не реализованы некоторые важные аспекты безопасности, такие как CSRF-защита для POST-форм (кроме AJAX, где можно добавить токены), более строгая валидация ввода, ограничение частоты запросов (rate limiting) к API.

## Известные ошибки или проблемы

*   **Отображение времени:** Из-за отката к `strtotime`/`time` возможны неточности в отображении относительного времени ("X sec ago"), особенно если таймзоны сервера и БД различаются.
*   **AJAX рендеринг поиска:** Кнопки лайков/комментариев/редактирования в результатах поиска, отрисованных через JS (`renderSearchResults`), могут не иметь привязанных обработчиков событий, так как используется упрощенный `innerHTML` без повторной инициализации *всех* интерактивных элементов.
*   **Ссылки в уведомлениях:** Ссылки на конкретные посты в уведомлениях (`/post/{id}`) являются плейсхолдерами, так как страница просмотра отдельного поста не реализована.
*   **Нет пагинации для подписчиков/подписок:** Модальные окна показывают всех подписчиков/подписки без пагинации.
*   **Безопасность:** Отсутствует CSRF-защита для стандартных POST-форм (создание поста, обновление профиля). Валидация ввода и загрузки файлов базовая.
*   **Gemini API:** Возможны ошибки, если ключ недействителен, не настроен, или превышены квоты Google Cloud, расположение клиента (сервера тоже).

## Почему выбран этот технический стек?

Выбор стека был продиктован требованиями технического задания и общим подходом к созданию PHP-приложения с современными элементами фронтенда:

*   **PHP:** Основной язык бэкенда, заданный в требованиях. Позволяет реализовать логику MVC, работу с БД и API.
*   **MySQL:** Стандартная реляционная СУБД, хорошо сочетающаяся с PHP.
*   **Apache:** Веб-сервер, выбранный для развертывания. PHP-FPM используется для лучшей производительности.
*   **Composer:** Необходим для подключения библиотек (FastRoute, и тд).
*   **MVC (Кастомный):** Выбран для организации структуры кода без избыточности больших фреймворков, что позволяет лучше контролировать все аспекты приложения, но требует больше ручной работы.
*   **Vite + npm:** Управление фронтенд-зависимостями (Tailwind) и быстрой сборки/разработки CSS и JS. Позволяет использовать последние возможности JS/CSS.
*   **Tailwind CSS (v4):** Утилитарный CSS-фреймворк, позволяющий быстро создавать кастомный дизайн (в данном случае, имитирующий shadcn) без написания большого количества CSS-кода. Версия 4 выбрана как последняя на момент разработки. (Кстати на русской википедии страница TailwindCSS была написана мной :)
*   **Vanilla JS + AJAX (`fetch`):** Обеспечивает динамическое взаимодействие (лайки, комментарии, поиск, подписки) без перезагрузки страницы, не требуя при этом изучения и подключения сложного JS-фреймворка, что лучше вписывается в "классическую" MVC-структуру с рендерингом на стороне сервера для основного контента.
*   **FastRoute:** Минималистичный и быстрый роутер, хорошо подходит для кастомной MVC-реализации.
*   **Google API Client/cURL:** `google/apiclient` для стандартной и надежной OAuth2 аутентификации; прямой cURL для Gemini API - для демонстрации прямого взаимодействия с HTTP API.
*   **Cloudflare:** Используется для управления DNS и может предоставлять дополнительные уровни кэширования и безопасности.

Этот стек представляет собой баланс между классическим PHP-подходом и современными практиками фронтенд-разработки, позволяя создать функциональное веб-приложение с хорошим UX.
