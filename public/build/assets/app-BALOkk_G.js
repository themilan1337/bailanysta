const h=typeof BASE_URL<"u"?BASE_URL:"",ce=typeof SESSION_USER_PICTURE<"u"?SESSION_USER_PICTURE:null;function be(e){const n=`; ${document.cookie}`.split(`; ${e}=`);return n.length===2?n.pop().split(";").shift():null}function de(e,t,n){let o="";{const s=new Date;s.setTime(s.getTime()+n*24*60*60*1e3),o="; expires="+s.toUTCString()}document.cookie=e+"="+(t||"")+o+"; path=/; SameSite=Lax"}function a(e){return typeof e!="string"?"":e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function V(e){return typeof e>"u"||e===null?"":(e+"").replace(/([^>\r\n]?)(\r\n|\n\r|\r|\n)/g,"$1<br>$2")}const ue=e=>{const t=document.documentElement;if(!t)return;e==="dark"?t.classList.add("dark"):t.classList.remove("dark");const n=document.getElementById("theme-toggle-sun-icon"),o=document.getElementById("theme-toggle-moon-icon");n&&o&&(n.style.display=e==="dark"?"none":"block",o.style.display=e==="dark"?"block":"none");const s=document.getElementById("theme-toggle-sun-icon-logged-out"),r=document.getElementById("theme-toggle-moon-icon-logged-out");s&&r&&(s.style.display=e==="dark"?"none":"block",r.style.display=e==="dark"?"block":"none")},M=()=>{const t=(document.documentElement.classList.contains("dark")?"dark":"light")==="dark"?"light":"dark";de("ui-theme",t,365),ue(t)},ye=()=>{console.log("Attempting to initialize theme...");const e=be("ui-theme"),t=e==="dark"||e==="light"?e:"light";(!e||e!=="dark"&&e!=="light")&&de("ui-theme",t,365),ue(t);const n=document.getElementById("theme-toggle"),o=document.getElementById("theme-toggle-logged-out");n&&(n.removeEventListener("click",M),n.addEventListener("click",M)),o&&(o.removeEventListener("click",M),o.addEventListener("click",M)),console.log("Theme initialized to:",t)},ve=(e,t,n)=>{var l;const o=e.querySelector(".like-count"),s=(l=e.querySelector("svg"))==null?void 0:l.parentElement;if(!o||!s){console.error("Could not find like count span or icon container for button:",e);return}o.textContent=n,e.classList.toggle("text-red-500",t),e.classList.toggle("font-medium",t),e.classList.toggle("text-muted-foreground",!t);const r=e.querySelector(".like-icon-filled"),i=e.querySelector(".like-icon-outline");r&&i?(r.style.display=t?"block":"none",i.style.display=t?"none":"block"):console.warn("Could not find like icons within button:",e),e.setAttribute("aria-pressed",t.toString())},W=async e=>{const t=e.currentTarget,n=t.dataset.postId;if(!n||t.disabled)return;const s=t.getAttribute("aria-pressed")==="true"?"DELETE":"POST",r=`/api/posts/${n}/like`;t.disabled=!0,t.classList.add("opacity-70");try{const i=await fetch(r,{method:s,headers:{Accept:"application/json"}}),l=await i.json();!i.ok||!l.success?console.error(`Failed to ${s==="POST"?"like":"unlike"} post:`,l.message||`HTTP ${i.status}`):(ve(t,l.userLiked,l.newLikeCount),t.setAttribute("aria-label",l.userLiked?"Unlike post":"Like post"))}catch(i){console.error("Network error during like/unlike:",i)}finally{t.disabled=!1,t.classList.remove("opacity-70")}},J=()=>{console.log("Attempting to initialize like buttons...");const e=document.querySelectorAll(".like-button");e.forEach(t=>{const n=t.classList.contains("text-red-500");t.setAttribute("aria-pressed",n.toString()),t.setAttribute("aria-label",n?"Unlike post":"Like post"),t.disabled||(t.removeEventListener("click",W),t.addEventListener("click",W))}),console.log(`Initialized ${e.length} like buttons.`)},me=e=>{const t=document.createElement("div");t.classList.add("comment-item","flex","items-start","space-x-2"),t.dataset.commentId=e.comment_id;const n=e.author_picture_url||"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541",o=e.author_name||"Unknown User",s=e.time_ago||"",r=e.content||"";return t.innerHTML=` <img src="${a(n)}" alt="${a(o)}'s profile picture" class="w-8 h-8 rounded-full border bg-muted flex-shrink-0"> <div class="flex-grow bg-muted/50 dark:bg-muted/20 rounded-md px-3 py-1.5"> <div class="flex items-baseline space-x-2"> <span class="font-semibold text-foreground text-xs">${a(o)}</span> <span class="text-muted-foreground text-xs">${a(s)}</span> </div> <p class="text-foreground leading-snug">${a(r).replace(/\n/g,"<br>")}</p> </div> `,t},xe=async(e,t)=>{const n=t.querySelector(".comment-list"),o=t.querySelector(".loading-comments");if(!(!n||!o)){o.style.display="flex",n.querySelectorAll(".comment-item, .no-comments, .text-destructive").forEach(s=>s.remove());try{const s=await fetch(`/api/posts/${e}/comments`),r=await s.json();if(!s.ok||!r.success){console.error("Failed load comments:",r.message||`HTTP ${s.status}`);const i=document.createElement("p");i.className="text-destructive text-xs text-center py-3",i.textContent="Could not load comments.",n.appendChild(i)}else if(r.comments&&r.comments.length>0)r.comments.forEach(i=>{n.appendChild(me(i))});else{const i=document.createElement("p");i.className="text-muted-foreground text-xs text-center py-3 no-comments",i.textContent="No comments yet.",n.appendChild(i)}}catch(s){console.error("Network error loading comments:",s);const r=document.createElement("p");r.className="text-destructive text-xs text-center py-3",r.textContent="Error loading comments.",n.appendChild(r)}finally{o.style.display="none"}}},X=e=>{var i;const t=e.currentTarget,n=t.dataset.postId,o=`comment-section-${n}`,s=document.getElementById(o);if(!s)return;if(t.getAttribute("aria-expanded")==="true")s.classList.add("hidden"),t.setAttribute("aria-expanded","false");else{s.classList.remove("hidden"),t.setAttribute("aria-expanded","true");const l=((i=s.querySelector(".comment-list"))==null?void 0:i.innerHTML.trim())||"";(!!s.querySelector(".loading-comments")||l===""||l.includes("no-comments")||l.includes("Could not load"))&&xe(n,s)}},K=async e=>{e.preventDefault();const t=e.currentTarget,n=t.dataset.postId,o=t.querySelector('textarea[name="content"]'),s=t.querySelector('button[type="submit"]'),r=document.getElementById(`comment-section-${n}`),i=r?r.querySelector(".comment-list"):null,l=document.querySelector(`[data-post-container-id="${n}"]`),d=l?l.querySelector(".comment-count-display"):null;if(console.log("handleAddComment Debug Info:"),console.log("  - Post ID:",n),console.log("  - Textarea found:",!!o),console.log("  - Submit Button found:",!!s),console.log("  - Comment Section found:",!!r),console.log("  - Comment List found:",!!i),console.log("  - Post Container found:",!!l),console.log("  - Comment Count Display found:",!!d),!n||!o||!s||!i||!d||!r||!l){console.error("Could not find necessary elements for adding comment. Check specific logs above.");return}const u=i,m=d,p=o.value.trim();if(p===""){o.focus(),o.classList.add("ring-1","ring-destructive"),setTimeout(()=>o.classList.remove("ring-1","ring-destructive"),1500);return}s.disabled=!0,s.textContent="Posting...";const f={content:p};console.log("[Comment Store - JS Sending]",JSON.stringify(f));try{const x=await fetch(`/api/posts/${n}/comments`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(f)}),y=await x.json();if(!x.ok||!y.success)console.error("Failed to add comment:",y.message||`HTTP ${x.status}`),alert(`Error: ${y.message||"Could not post comment."}`);else{o.value="";const g=u.querySelector(".no-comments");g&&g.remove(),y.comment&&u.appendChild(me(y.comment));const P=y.newCommentCount;m.textContent=`${P} ${P===1?"Comment":"Comments"}`}}catch(x){console.error("Network error adding comment:",x),alert("A network error occurred. Please try again.")}finally{s.disabled=!1,s.textContent="Post"}},Z=()=>{console.log("Attempting to initialize comments..."),document.querySelectorAll(".comment-toggle-button").forEach(e=>{e.removeEventListener("click",X),e.disabled||e.addEventListener("click",X)}),document.querySelectorAll(".add-comment-form").forEach(e=>{e.removeEventListener("submit",K),e.addEventListener("submit",K)}),console.log("Comment listeners attached.")},we=(e,t)=>{const n=e.querySelector(".follow-text");n&&(n.textContent=t?"Following":"Follow",e.classList.toggle("border",t),e.classList.toggle("border-input",t),e.classList.toggle("bg-background",t),e.classList.toggle("hover:bg-accent",t),e.classList.toggle("hover:text-accent-foreground",t),e.classList.toggle("bg-primary",!t),e.classList.toggle("text-primary-foreground",!t),e.classList.toggle("hover:bg-primary/90",!t),e.setAttribute("aria-pressed",t.toString()))},H=async e=>{const t=e.currentTarget,n=t.dataset.userId,o=t.querySelector(".loading-spinner");if(!n||t.disabled)return;const r=t.getAttribute("aria-pressed")==="true"?"DELETE":"POST",i=`/api/users/${n}/follow`;t.disabled=!0,o&&o.classList.remove("hidden");try{const l=await fetch(i,{method:r,headers:{Accept:"application/json"}}),d=await l.json();!l.ok||!d.success?(console.error(`Failed to ${r==="POST"?"follow":"unfollow"} user:`,d.message||`HTTP ${l.status}`),alert(`Error: ${d.message||"Could not perform follow action."}`)):(we(t,d.isFollowingNow),console.log(d.message))}catch(l){console.error("Network error during follow/unfollow:",l),alert("A network error occurred. Please try again.")}finally{t.disabled=!1,o&&o.classList.add("hidden")}},ke=()=>{console.log("Attempting to initialize follow buttons..."),document.querySelectorAll(".follow-toggle-button").forEach(e=>{e.removeEventListener("click",H),e.disabled||e.addEventListener("click",H)}),console.log("Follow button listeners attached.")},Y=(e,t)=>{var i;const n=e.querySelector(".post-display-content"),o=e.querySelector(".post-edit-form"),s=e.querySelector(".post-options-menu"),r=o==null?void 0:o.querySelector(".edit-status");if(!(!n||!o))if(n.classList.toggle("hidden",t),o.classList.toggle("hidden",!t),r&&(r.textContent=""),t&&s&&s.classList.add("hidden"),t)(i=o.querySelector("textarea"))==null||i.focus();else{n.innerHTML;const l=n.textContent||"";o.querySelector("textarea").value=l}},Q=e=>{const n=e.currentTarget.closest("article[data-post-container-id]");n&&Y(n,!0)},ee=e=>{const n=e.currentTarget.closest("article[data-post-container-id]");n&&Y(n,!1)},te=async e=>{e.preventDefault();const t=e.currentTarget,n=t.dataset.postId,o=t.querySelector('textarea[name="content"]'),s=t.querySelector(".edit-save-button"),r=t.querySelector(".edit-cancel-button"),i=t.querySelector(".edit-status"),l=t.closest("article[data-post-container-id]"),d=l==null?void 0:l.querySelector(".post-display-content");if(!n||!o||!s||!r||!l||!d||!i){console.error("Missing elements for edit save.");return}const u=o.value.trim();if(u===""){alert("Post content cannot be empty."),o.focus();return}s.disabled=!0,r.disabled=!0,o.disabled=!0,i.textContent="Saving...",i.classList.remove("text-destructive");const m={content:u};try{const p=await fetch(`/api/posts/${n}/update`,{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(m)}),f=await p.json();!p.ok||!f.success?(console.error("Update post error:",f.message||`HTTP ${p.status}`),i.textContent=`Error: ${f.message||"Could not save."}`,i.classList.add("text-destructive"),s.disabled=!1,r.disabled=!1,o.disabled=!1):(d.innerHTML=f.newContentHtml||V(a(u)),i.textContent="",Y(l,!1),s.disabled=!1,r.disabled=!1,o.disabled=!1)}catch(p){console.error("Network error updating post:",p),i.textContent="Network error.",i.classList.add("text-destructive"),alert("Network error saving post."),s.disabled=!1,r.disabled=!1,o.disabled=!1}},oe=async e=>{const t=e.currentTarget,n=t.closest("article[data-post-container-id]"),o=n==null?void 0:n.dataset.postContainerId,s=t.closest(".post-options-menu");if(!(!o||!n)){if(!confirm("Are you sure you want to delete this post? This cannot be undone.")){s&&s.classList.add("hidden");return}t.disabled=!0,s&&s.classList.add("hidden");try{const r=await fetch(`/api/posts/${o}`,{method:"DELETE",headers:{Accept:"application/json"}}),i=await r.json();!r.ok||!i.success?(console.error("Failed to delete post:",i.message||`HTTP ${r.status}`),alert(`Error: ${i.message||"Could not delete post."}`),t.disabled=!1):(console.log(i.message),n.style.transition="opacity 0.5s ease-out",n.style.opacity="0",setTimeout(()=>{n.remove()},500))}catch(r){console.error("Network error deleting post:",r),alert("A network error occurred while deleting the post."),t.disabled=!1}}},G=()=>{console.log("Attempting to initialize post options..."),document.querySelectorAll(".post-options-dropdown").forEach(e=>{const t=e.querySelector(".post-options-button"),n=e.querySelector(".post-options-menu");if(!t||!n)return;t.removeEventListener("click",ne),t.addEventListener("click",ne);const o=n.querySelector(".post-edit-button");o&&(o.removeEventListener("click",Q),o.addEventListener("click",Q));const s=n.querySelector(".post-delete-button");s&&(s.removeEventListener("click",oe),s.addEventListener("click",oe))}),document.removeEventListener("click",z),document.addEventListener("click",z),document.querySelectorAll(".post-edit-form").forEach(e=>{const t=e.querySelector(".edit-cancel-button");t&&(t.removeEventListener("click",ee),t.addEventListener("click",ee)),e.removeEventListener("submit",te),e.addEventListener("submit",te)}),console.log("Post options listeners attached.")},ne=e=>{var s;e.stopPropagation();const n=(s=e.currentTarget.closest(".post-options-dropdown"))==null?void 0:s.querySelector(".post-options-menu");if(!n)return;const o=n.classList.contains("hidden");z(e,n),o?n.classList.remove("hidden"):n.classList.add("hidden")},z=(e,t=null)=>{document.querySelectorAll(".post-options-menu").forEach(n=>{n!==t&&!n.closest(".post-options-dropdown").contains(e.target)&&n.classList.add("hidden")})},F=document.getElementById("notification-toggle-button"),_=document.getElementById("notification-count-badge"),q=document.getElementById("notification-list"),S=document.getElementById("notification-items-container"),A=document.getElementById("mark-all-read-button");let k=[];const Le=e=>{let t="",n="#";const o=a(e.actor_name||"Someone"),s=a(e.actor_picture||"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541"),r=a(e.time_ago||"");switch(e.type){case"like":t="liked your post.",e.post_id&&(n=`/post/${e.post_id}`,n="#");break;case"comment":t="commented on your post.",e.post_id&&(n=`/post/${e.post_id}`,n="#");break;case"follow":t="started following you.",e.actor_id&&(n=`/profile/${e.actor_id}`);break;default:t="sent you a notification."}return`
                    <a href="${n}" class="notification-item flex items-start px-3 py-2 hover:bg-accent text-foreground" data-notification-id="${e.id}">
                        <img src="${s}" alt="${o}'s picture" class="w-8 h-8 rounded-full border bg-muted mr-2 flex-shrink-0">
                        <div class="flex-grow">
                            <p class="text-xs leading-snug">
                                <strong class="font-medium">${o}</strong> ${t}
                            </p>
                            <p class="text-xs text-muted-foreground mt-0.5">${r}</p>
                        </div>
                        ${e.is_read?"":'<span class="ml-2 mt-1 w-2 h-2 bg-primary rounded-full flex-shrink-0" title="Unread"></span>'}
                    </a>
                `},pe=(e,t)=>{_&&(e>0?(_.textContent=e>9?"9+":e,_.classList.remove("hidden")):_.classList.add("hidden")),S&&(t.length>0?S.innerHTML=t.map(Le).join(""):S.innerHTML='<p class="p-4 text-muted-foreground text-center text-xs">No unread notifications.</p>'),A&&(A.disabled=e===0)},$e=async()=>{if(F){console.log("Fetching notifications...");try{const e=await fetch("/api/notifications");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);const t=await e.json();t.success?(k=t.notifications||[],pe(t.unread_count||0,k)):(console.error("Failed to fetch notifications:",t.message),S&&(S.innerHTML='<p class="p-4 text-destructive text-center text-xs">Could not load notifications.</p>'))}catch(e){console.error("Network error fetching notifications:",e),S&&(S.innerHTML='<p class="p-4 text-destructive text-center text-xs">Error loading notifications.</p>'),_&&_.classList.add("hidden"),A&&(A.disabled=!0)}}},Ee=async(e=0,t=I,n=!1)=>{if(!(C&&!n)){C=!0,c&&(c.style.display="flex"),console.log(`Fetching posts: Offset=${e}, Limit=${t}, Replace=${n}`);try{const o=await fetch(`${h}/?ajax=1&offset=${e}&limit=${t}`),s=await o.json();if(!o.ok||!s.success)throw new Error(s.message||"Failed to load feed data");fe(s.posts||[],n),n?he():s.posts.length<t&&(b=!0,c&&(c.innerHTML='<p class="text-muted-foreground text-sm text-center py-4">End of feed.</p>',c.style.display="flex"))}catch(o){console.error("Error in fetchAndRenderFeedPage:",o),c&&(c.innerHTML='<p class="text-destructive text-sm text-center py-4">Error loading feed.</p>'),b=!0}finally{C=!1,!n&&!b&&c&&(c.style.display="none")}}},se=async(e=null)=>{if(!e&&k.length===0)return;const t=e||k.map(n=>n.id);if(t.length!==0){console.log("Marking notifications read:",t);try{const n=await fetch("/api/notifications/mark-read",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify({ids:t})}),o=await n.json();!n.ok||!o.success?console.error("Failed to mark notifications read:",o.message):(console.log("Notifications marked read."),k=k.filter(s=>!t.includes(s.id)),pe(k.length,k))}catch(n){console.error("Network error marking notifications read:",n)}}},Ce=()=>{F&&(console.log("Initializing notifications..."),F.addEventListener("click",e=>{e.stopPropagation();const t=q.classList.contains("hidden");z(e),q.classList.toggle("hidden"),t&&k.length>0&&setTimeout(()=>{se()},5e3)}),A&&A.addEventListener("click",()=>{se()}),document.addEventListener("click",e=>{!q.classList.contains("hidden")&&!notificationDropdownContainer.contains(e.target)&&q.classList.add("hidden")}),$e(),console.log("Notification listeners attached."))},re=document.getElementById("search-input"),v=document.getElementById("feed-posts-container"),j=document.getElementById("search-spinner"),w=document.getElementById("search-error");v&&v.innerHTML;let ie=null,L=null;const Se=e=>{if(!v)return;w.textContent="",w.classList.add("hidden");const t=!!document.querySelector('a[href$="/logout"]'),n=typeof CURRENT_USER_ID<"u"?CURRENT_USER_ID:null;e.length===0?v.innerHTML='<p class="text-center text-muted-foreground py-10">No posts found matching your search.</p>':(v.innerHTML=e.map(o=>{const s=n!==null&&n===o.author_id,r=`like-button flex items-center justify-center space-x-1.5 py-1.5 px-3 rounded-md hover:bg-accent transition-colors ${o.user_liked?"text-red-500 font-medium":"text-muted-foreground"} ${t?"":"cursor-not-allowed opacity-60"}`,i=t?"":'disabled title="Login to like posts"',l=o.user_liked?"Unlike":"Like",d=o.user_liked?"true":"false",u=`display: ${o.user_liked?"none":"block"};`,m=`display: ${o.user_liked?"block":"none"};`,p=`comment-toggle-button flex items-center justify-center space-x-1.5 py-1.5 px-3 rounded-md text-muted-foreground hover:bg-accent transition-colors ${t?"":"cursor-not-allowed opacity-60"}`,f=t?"":'disabled title="Login to comment"',x=a(o.author_picture_url||"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541"),y=a(ce||"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541");return`
                             <article class="bg-card border rounded-lg shadow-sm overflow-hidden flex flex-col" data-post-container-id="${o.post_id}">
                                 <div class="p-4 flex items-start space-x-3">
                                     <a href="${h}/profile/${o.author_id}">
                                         <img src="${x}" alt="${a(o.author_name)}'s picture" class="w-10 h-10 rounded-full border bg-muted hover:opacity-80 transition-opacity">
                                     </a>
                                     <div class="flex-grow">
                                         <a href="${h}/profile/${o.author_id}" class="font-semibold text-foreground hover:underline">${a(o.author_name)}</a>
                                         <p class="text-xs text-muted-foreground">${a(o.time_ago)}</p>
                                     </div>
                                     ${s?`
                                          <div class="relative post-options-dropdown">
                                             <button type="button" aria-label="Post options" class="post-options-button p-1 rounded-full text-muted-foreground hover:bg-accent hover:text-foreground focus:outline-none focus:ring-1 focus:ring-ring"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" /></svg></button>
                                             <div class="post-options-menu hidden absolute right-0 mt-1 w-36 bg-popover border rounded-md shadow-lg z-10 py-1 text-sm">
                                                <button type="button" class="post-edit-button cursor-pointer block w-full text-left px-3 py-1.5 text-foreground hover:bg-accent">Edit Post</button>
                                                <button type="button" class="post-delete-button cursor-pointer block w-full text-left px-3 py-1.5 text-destructive hover:bg-destructive/10">Delete Post</button>
                                             </div>
                                          </div>
                                     `:""}
                                 </div>
            
                                 <div class="post-content-area px-4 ${o.content?"pb-4":"pb-1"}">
                                    ${o.content?`<div class="post-display-content prose prose-sm dark:prose-invert max-w-none">${V(a(o.content))}</div>`:""}
                                    ${s?`
                                        <form class="post-edit-form hidden mt-2" data-post-id="${o.post_id}">
                                            <textarea name="content" rows="5" class="w-full p-2 border border-input bg-background rounded-md focus:ring-1 focus:ring-ring focus:outline-none resize-y placeholder:text-muted-foreground text-sm" required>${a(o.content||"")}</textarea>
                                            <div class="flex justify-end items-center space-x-2 mt-2">
                                                <span class="edit-status text-xs text-muted-foreground"></span>
                                                <button type="button" class="edit-cancel-button cursor-pointer inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 px-3">Cancel</button>
                                                <button type="submit" class="edit-save-button cursor-pointer inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-8 px-3">Save Changes</button>
                                            </div>
                                        </form>
                                        `:""}
                                 </div>
            
                                 ${o.image_url?`
                                     <div class="bg-muted border-t dark:border-gray-700 max-h-[60vh] overflow-hidden">
                                          <a href="${h}${a(o.image_url)}" target="_blank" rel="noopener noreferrer" title="View full image">
                                               <img src="${h}${a(o.image_url)}" alt="Post image" class="w-full h-auto object-contain display-block" loading="lazy">
                                          </a>
                                     </div>
                                 `:""}
            
                                 <div class="px-4 pt-3 pb-1 border-t flex items-center justify-between text-sm text-muted-foreground">
                                    <div class="flex space-x-4">
                                       <span class="like-count-display">${o.like_count} ${o.like_count==1?"Like":"Likes"}</span>
                                       <span class="comment-count-display">${o.comment_count} ${o.comment_count==1?"Comment":"Comments"}</span>
                                    </div>
                                 </div>
            
                                  <div class="p-2 border-t grid grid-cols-2 gap-1">
                                        <button data-post-id="${o.post_id}" aria-label="${l} post" aria-pressed="${d}" class="${r}" ${i}>
                                            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="like-icon-outline cursor-pointer w-5 h-5" style="${u}"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg>
                                            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="like-icon-filled w-5 h-5" style="${m}"><path d="M9.653 16.915l-.005-.003-.019-.01a20.759 20.759 0 01-1.162-.682 22.045 22.045 0 01-2.582-1.9C4.045 12.733 2 10.352 2 7.5a4.5 4.5 0 018-2.828A4.5 4.5 0 0118 7.5c0 2.852-2.044 5.233-3.885 6.82a22.049 22.049 0 01-3.744 2.582l-.019.01-.005.003h-.002a.739.739 0 01-.69.001l-.002-.001z" /></svg>
                                            <span>Like <span class="like-count font-normal">${o.like_count}</span></span>
                                        </button>
                                        <button data-post-id="${o.post_id}" aria-expanded="false" aria-controls="comment-section-${o.post_id}" class="${p}" ${f}>
                                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 011.037-.443 48.282 48.282 0 005.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" /></svg>
                                           <span>Comment</span>
                                       </button>
                                  </div>
                                  <div id="comment-section-${o.post_id}" class="comment-section border-t px-4 py-3 space-y-3 hidden">
                                        <div class="comment-list space-y-3 text-sm">
                                            <p class="text-muted-foreground text-xs loading-comments">Loading comments...</p>
                                        </div>
                                        ${t?`
                                        <form class="add-comment-form flex items-start space-x-2 pt-3" data-post-id="${o.post_id}">
                                            <img src="${y}" alt="Your profile picture" class="w-8 h-8 rounded-full border bg-muted flex-shrink-0 mt-1">
                                            <div class="flex-grow">
                                                <textarea name="content" rows="1" class="w-full p-2 border border-input bg-background rounded-md focus:ring-1 focus:ring-ring focus:outline-none resize-none placeholder:text-muted-foreground text-sm" placeholder="Add a comment..."></textarea>
                                                <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-7 px-3 mt-1 float-right">Post</button>
                                            </div>
                                        </form>
                                        `:""}
                                  </div>
                             </article>
                         `}).join(""),J(),Z(),G())},Te=async e=>{if(!v||!j||!w)return;L&&(L.abort(),console.log("Aborted previous search request.")),L=new AbortController;const t=L.signal;j.classList.remove("hidden"),w.textContent="",w.classList.add("hidden");const n=e.trim();if(n===""){console.log("Search cleared, reloading initial feed page via AJAX."),j.classList.add("hidden"),window.removeEventListener("scroll",N),await Ee(0,I,!0),L=null;return}const o=encodeURIComponent(n);console.log(`Performing search for: ${n}`);try{const s=await fetch(`/api/posts/search?q=${o}`,{signal:t});if(t.aborted){console.log("Search request aborted before response processed.");return}if(!s.ok)throw new Error(`HTTP error! status: ${s.status}`);const r=await s.json();r.success?(Se(r.posts),window.removeEventListener("scroll",N),b=!0,c&&(c.style.display="none"),console.log("Infinite scroll disabled after search.")):(w.textContent=r.message||"Search failed.",w.classList.remove("hidden"),v&&(v.innerHTML=""))}catch(s){s.name==="AbortError"?console.log("Search request aborted."):(console.error("Search network error:",s),w.textContent="Error performing search.",w.classList.remove("hidden"),v&&(v.innerHTML=""))}finally{j.classList.add("hidden"),L&&L.signal===t&&(L=null)}},_e=()=>{re&&(console.log("Initializing search..."),re.addEventListener("input",e=>{const t=e.target.value;clearTimeout(ie),ie=setTimeout(()=>{Te(t)},500)}),console.log("Search listener attached."))},le=async e=>{const t=e.currentTarget,n=t.getAttribute("form"),o=n?document.getElementById(n):t.closest("form");if(!o){console.error("Could not find associated form for generate idea button."),alert("Error: Cannot find form context.");return}const s=o.querySelector('textarea[name="content"]'),r=o.querySelector('input[name="ai_prompt"]');if(!s){console.error("Could not find associated textarea within the form."),alert("Error: Cannot find where to put the generated idea.");return}const i=r?r.value.trim():"";t.disabled=!0;const l=t.innerHTML;t.innerHTML=`
                    <svg class="animate-spin h-4 w-4 text-current" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                       <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                       <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                    </svg>
                    <span>Generating...</span>`;try{const d={};i!==""&&(d.prompt=i);const u=await fetch("/api/ai/generate-post-idea",{method:"POST",headers:{"Content-Type":"application/json",Accept:"application/json"},body:JSON.stringify(d)}),m=await u.json();!u.ok||!m.success?(console.error("Failed to generate content:",m.message||`HTTP ${u.status}`),alert(`Error generating idea: ${m.message||"Request failed."}`)):m.idea?(s.value=m.idea,s.focus()):alert("Received an empty idea from the AI service.")}catch(d){console.error("Network error generating idea:",d),alert("A network error occurred while generating the idea.")}finally{t.disabled=!1,t.innerHTML=l}},Ie=()=>{console.log("Initializing AI features..."),document.querySelectorAll(".generate-idea-button").forEach(e=>{e.removeEventListener("click",le),e.addEventListener("click",le)}),console.log("AI feature listeners attached.")},$=document.getElementById("follow-list-modal"),B=document.getElementById("follow-list-modal-title"),T=document.getElementById("follow-list-content"),R=document.getElementById("close-follow-modal-button"),Ae=(e,t)=>{if(!T||!B)return;if(B.textContent=t.charAt(0).toUpperCase()+t.slice(1),!e||e.length===0){T.innerHTML='<p class="text-center text-muted-foreground py-4">No users found.</p>';return}const n=typeof CURRENT_USER_ID<"u"?CURRENT_USER_ID:null;T.innerHTML=e.map(o=>{const s=o.viewer_is_following,r=n===o.id;let i="";if(n!==null&&!r){const l=`follow-toggle-button inline-flex items-center justify-center whitespace-nowrap rounded-md text-xs font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 h-7 px-2 ${s?"border border-input bg-background hover:bg-accent hover:text-accent-foreground":"bg-primary text-primary-foreground hover:bg-primary/90"}`,d=s?"Following":"Follow",u=s?"true":"false";i=`<button type="button" data-user-id="${o.id}" class="${l}" aria-pressed="${u}"><span class="follow-text">${d}</span></button>`}return`
            <div class="flex items-center justify-between space-x-3 py-1.5">
                <a href="${h}/profile/${o.id}" class="flex items-center space-x-2 min-w-0 group">
                    <img src="${a(o.picture_url||"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541")}" alt="${a(o.name)}'s picture" class="w-9 h-9 rounded-full border bg-muted flex-shrink-0 group-hover:opacity-80">
                    <div class="min-w-0 flex-1">
                        <p class="text-sm font-medium text-foreground truncate group-hover:underline">${a(o.name)}</p>
                        ${o.nickname?`<p class="text-xs text-muted-foreground truncate">@${a(o.nickname)}</p>`:""}
                    </div>
                </a>
                <div class="flex-shrink-0 ml-auto">
                    ${i}
                </div>
            </div>
        `}).join(""),Be(T)},ae=async e=>{const t=e.currentTarget,n=t.dataset.userId,o=t.dataset.listType;if(!(!n||!o||!$||!T||!B)){$.classList.remove("hidden"),$.classList.add("flex"),B.textContent=`Loading ${o}...`,T.innerHTML=`
        <div class="loading-follow-list flex justify-center items-center py-6 text-muted-foreground">
              <svg class="animate-spin h-6 w-6 mr-3" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
              </svg>
              <span>Loading Users...</span>
        </div>`;try{const s=`/api/users/${n}/${o}`,r=await fetch(s),i=await r.json();if(!r.ok||!i.success)throw new Error(i.message||`Failed to load ${o}`);Ae(i.users,o)}catch(s){console.error(`Error fetching ${o}:`,s),T.innerHTML='<p class="text-center text-destructive py-4">Error loading list.</p>',B.textContent="Error"}}},D=()=>{$&&($.classList.add("hidden"),$.classList.remove("flex"))},Be=e=>{e&&(e.querySelectorAll(".follow-toggle-button").forEach(t=>{t.removeEventListener("click",H),t.disabled||t.addEventListener("click",H)}),console.log("Follow buttons within modal initialized."))},Pe=()=>{$&&(console.log("Initializing follow list triggers..."),document.querySelectorAll(".show-follow-list-button").forEach(e=>{e.removeEventListener("click",ae),e.addEventListener("click",ae)}),R&&(R.removeEventListener("click",D),R.addEventListener("click",D)),document.addEventListener("keydown",e=>{e.key==="Escape"&&!$.classList.contains("hidden")&&D()}))},E=document.getElementById("feed-posts-container"),c=document.getElementById("loading-indicator");let C=!1,b=!1;const I=5,fe=(e,t=!1)=>{if(!E||!e)return;const n=!!document.querySelector('a[href$="/logout"]'),o=typeof CURRENT_USER_ID<"u"?CURRENT_USER_ID:null,s=e.map(r=>{const i=o!==null&&o===r.author_id,l=`like-button flex items-center justify-center space-x-1.5 py-1.5 px-3 rounded-md hover:bg-accent transition-colors ${r.user_liked?"text-red-500 font-medium":"text-muted-foreground"} ${n?"":"cursor-not-allowed opacity-60"}`,d=n?"":'disabled title="Login to like posts"',u=r.user_liked?"Unlike":"Like",m=r.user_liked?"true":"false",p=`display: ${r.user_liked?"none":"block"};`,f=`display: ${r.user_liked?"block":"none"};`,x=`comment-toggle-button flex items-center justify-center cursor-pointer space-x-1.5 py-1.5 px-3 rounded-md text-muted-foreground hover:bg-accent transition-colors ${n?"":"cursor-not-allowed opacity-60"}`,y=n?"":'disabled title="Login to comment"';let g=r.author_picture_url||"https://upload.wikimedia.org/wikipedia/commons/7/7c/Profile_avatar_placeholder_large.png?20150327203541";g&&g.startsWith("/")&&(g=h+g),g=a(g);const P=a(ce||"https://via.placeholder.com/32/cccccc/969696?text=");let U=r.image_url?h+a(r.image_url):null;return`
            <article class="bg-card border rounded-lg shadow-sm overflow-hidden flex flex-col ${t?"opacity-100":"opacity-0 transition-opacity duration-500"}" data-post-container-id="${r.post_id}">
                <div class="p-4 flex items-start space-x-3">
                    <a href="${h}/profile/${r.author_id}">
                        <img src="${g}" alt="${a(r.author_name)}'s picture" class="w-10 h-10 rounded-full border bg-muted hover:opacity-80 transition-opacity">
                    </a>
                    <div class="flex-grow">
                        <a href="${h}/profile/${r.author_id}" class="font-semibold text-foreground hover:underline">${a(r.author_name)}</a>
                        <p class="text-xs text-muted-foreground">${a(r.time_ago)}</p>
                    </div>
                    ${i?`
                        <div class="relative post-options-dropdown">
                           <button type="button" aria-label="Post options" class="post-options-button p-1 rounded-full text-muted-foreground hover:bg-accent hover:text-foreground focus:outline-none focus:ring-1 focus:ring-ring"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="w-5 h-5"><path d="M10 3a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM10 8.5a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM11.5 15.5a1.5 1.5 0 1 0-3 0 1.5 1.5 0 0 0 3 0Z" /></svg></button>
                           <div class="post-options-menu hidden absolute right-0 mt-1 w-36 bg-popover border rounded-md shadow-lg z-10 py-1 text-sm">
                              <button type="button" class="post-edit-button block w-full text-left px-3 py-1.5 text-foreground hover:bg-accent">Edit Post</button>
                              <button type="button" class="post-delete-button block w-full text-left px-3 py-1.5 text-destructive hover:bg-destructive/10">Delete Post</button>
                           </div>
                        </div>
                    `:""}
                </div>

                <div class="post-content-area px-4 ${r.content?"pb-4":"pb-1"}">
                   ${r.content?`<div class="post-display-content prose prose-sm dark:prose-invert max-w-none">${V(a(r.content))}</div>`:""}
                   ${i?`
                       <form class="post-edit-form hidden mt-2" data-post-id="${r.post_id}">
                           <textarea name="content" rows="5" class="w-full p-2 border border-input bg-background rounded-md focus:ring-1 focus:ring-ring focus:outline-none resize-y placeholder:text-muted-foreground text-sm" required>${a(r.content||"")}</textarea>
                           <div class="flex justify-end items-center space-x-2 mt-2">
                               <span class="edit-status text-xs text-muted-foreground"></span>
                               <button type="button" class="edit-cancel-button inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 border border-input bg-background hover:bg-accent hover:text-accent-foreground h-8 px-3">Cancel</button>
                               <button type="submit" class="edit-save-button inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-8 px-3">Save Changes</button>
                           </div>
                       </form>
                       `:""}
                </div>

                ${U?`
                    <div class="post-display-image bg-muted border-t dark:border-gray-700 max-h-[60vh] overflow-hidden">
                         <a href="${U}" target="_blank" rel="noopener noreferrer" title="View full image">
                              <img src="${U}" alt="Post image" class="w-full h-auto object-contain display-block" loading="lazy">
                         </a>
                    </div>
                `:""}

                <div class="px-4 pt-3 pb-1 border-t flex items-center justify-between text-sm text-muted-foreground">
                   <div class="flex space-x-4">
                      <span class="like-count-display">${r.like_count} ${r.like_count==1?"Like":"Likes"}</span>
                      <span class="comment-count-display">${r.comment_count} ${r.comment_count==1?"Comment":"Comments"}</span>
                   </div>
                </div>

                 <div class="p-2 border-t grid grid-cols-2 gap-1">
                       <button data-post-id="${r.post_id}" aria-label="${u} post" aria-pressed="${m}" class="${l}" ${d}>
                           <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="like-icon-outline w-5 h-5" style="${p}"><path stroke-linecap="round" stroke-linejoin="round" d="M21 8.25c0-2.485-2.099-4.5-4.688-4.5-1.935 0-3.597 1.126-4.312 2.733-.715-1.607-2.377-2.733-4.313-2.733C5.1 3.75 3 5.765 3 8.25c0 7.22 9 12 9 12s9-4.78 9-12z" /></svg>
                           <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" class="like-icon-filled w-5 h-5" style="${f}"><path d="M9.653 16.915l-.005-.003-.019-.01a20.759 20.759 0 01-1.162-.682 22.045 22.045 0 01-2.582-1.9C4.045 12.733 2 10.352 2 7.5a4.5 4.5 0 018-2.828A4.5 4.5 0 0118 7.5c0 2.852-2.044 5.233-3.885 6.82a22.049 22.049 0 01-3.744 2.582l-.019.01-.005.003h-.002a.739.739 0 01-.69.001l-.002-.001z" /></svg>
                           <span>Like <span class="like-count font-normal">${r.like_count}</span></span>
                       </button>
                       <button data-post-id="${r.post_id}" aria-expanded="false" aria-controls="comment-section-${r.post_id}" class="${x}" ${y}>
                          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" class="w-5 h-5"><path stroke-linecap="round" stroke-linejoin="round" d="M2.25 12.76c0 1.6 1.123 2.994 2.707 3.227 1.087.16 2.185.283 3.293.369V21l4.076-4.076a1.526 1.526 0 011.037-.443 48.282 48.282 0 005.68-.494c1.584-.233 2.707-1.626 2.707-3.228V6.741c0-1.602-1.123-2.995-2.707-3.228A48.394 48.394 0 0012 3c-2.392 0-4.744.175-7.043.513C3.373 3.746 2.25 5.14 2.25 6.741v6.018z" /></svg>
                          <span>Comment</span>
                      </button>
                 </div>
                 <div id="comment-section-${r.post_id}" class="comment-section border-t px-4 py-3 space-y-3 hidden">
                       <div class="comment-list space-y-3 text-sm">
                           <p class="text-muted-foreground text-xs loading-comments">Loading comments...</p>
                       </div>
                       ${n?`
                       <form class="add-comment-form flex items-start space-x-2 pt-3" data-post-id="${r.post_id}">
                           <img src="${P}" alt="Your profile picture" class="w-8 h-8 rounded-full border bg-muted flex-shrink-0 mt-1">
                           <div class="flex-grow">
                               <textarea name="content" rows="1" class="w-full p-2 border border-input bg-background rounded-md focus:ring-1 focus:ring-ring focus:outline-none resize-none placeholder:text-muted-foreground text-sm" placeholder="Add a comment..."></textarea>
                               <button type="submit" class="inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 bg-primary text-primary-foreground hover:bg-primary/90 h-7 px-3 mt-1 float-right">Post</button>
                           </div>
                       </form>
                       `:""}
                 </div>
            </article>
        `}).join("");if(t)E.innerHTML=s;else{const r=document.createElement("div");r.innerHTML=s,Array.from(r.children).forEach(i=>{E.appendChild(i),requestAnimationFrame(()=>{requestAnimationFrame(()=>{i.classList.remove("opacity-0")})})})}J(),Z(),G()},Me=async()=>{if(C||b||!E||!c)return;C=!0,c.style.display="block",c.innerHTML='<p class="text-gray-500 dark:text-gray-400">Loading more posts...</p>';const t=E.querySelectorAll("article[data-post-container-id]").length;console.log(`Loading more posts... Offset: ${t}, Limit: ${I}`);try{const n=await fetch(`${h}/?ajax=1&offset=${t}&limit=${I}`),o=await n.json();if(!n.ok||!o.success)throw new Error(o.message||"Failed to load more posts");o.posts&&o.posts.length>0?(fe(o.posts),o.posts.length<I?(b=!0,c.innerHTML='<p class="text-muted-foreground text-sm py-4">End of feed.</p>',console.log("Reached end of feed (loaded < limit).")):c.style.display="none"):(console.log("No more posts to load (API returned empty)."),b=!0,c.innerHTML='<p class="text-muted-foreground text-sm py-4">No more posts.</p>')}catch(n){console.error("Error loading more posts:",n),c.innerHTML='<p class="text-destructive text-sm py-4">Error loading posts.</p>'}finally{C=!1,b||(c.style.display="none")}};let O;const N=()=>{O||(O=setTimeout(()=>{O=null,ge()},250))},ge=()=>{if(C||b||!E||!c)return;window.innerHeight+window.scrollY>=document.documentElement.scrollHeight-350&&(console.log("Scroll threshold met, calling loadMorePosts."),Me())},he=()=>{if(!E||!c){console.log("Infinite scroll elements not found, skipping initialization.");return}const e=E.querySelectorAll("article[data-post-container-id]").length;console.log("Init Infinite Scroll - Initial Post Count:",e),window.removeEventListener("scroll",N),b=!1,C=!1,c.style.display="none",c.innerHTML='<p class="text-gray-500 dark:text-gray-400">Loading more posts...</p>',e<I?(b=!0,c.innerHTML='<p class="text-muted-foreground text-sm py-4">End of feed.</p>',c.style.display="block",console.log("Initial load < limit, infinite scroll inactive.")):(console.log("Initializing infinite scroll listener."),window.addEventListener("scroll",N),setTimeout(ge,150))};document.getElementById("feed-posts-container");const qe=()=>{const e=document.getElementById("mobile-menu-button"),t=document.getElementById("mobile-menu"),n=document.getElementById("menu-icon-open"),o=document.getElementById("menu-icon-close");!e||!t||!n||!o||(console.log("Initializing mobile menu..."),e.addEventListener("click",()=>{const s=e.getAttribute("aria-expanded")==="true";t.classList.toggle("hidden"),n.classList.toggle("hidden",!s),o.classList.toggle("hidden",s),e.setAttribute("aria-expanded",!s)}),t.querySelectorAll("a").forEach(s=>{s.addEventListener("click",()=>{t.classList.add("hidden"),n.classList.remove("hidden"),o.classList.add("hidden"),e.setAttribute("aria-expanded","false")})}),console.log("Mobile menu listeners attached."))};document.addEventListener("DOMContentLoaded",()=>{console.log("DOMContentLoaded event fired."),ye(),J(),Z(),ke(),G(),Ce(),_e(),Ie(),Pe(),he(),qe()});
